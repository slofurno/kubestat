<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
           canvas, img {
            image-rendering: pixelated;
        }
        html {
      box-sizing: border-box;
  }
  body {
    margin: 0px;
  }
  *, *:before, *:after {
      box-sizing: inherit;
  }
</style>
</head>
<body>
  <div id="root">
    <div id="cpu-use" style="padding: 10px;"></div>

    <div id="cpu-use2" style="padding: 10px;"></div>

    <div id="throttled-time" style="padding: 10px;"></div>

    <div id="resident" style="padding: 10px;"></div>
  </div>
  <script src="index.js"></script>
  <script>
      let pods = {}
      function getTime(x) {
	      let d = new Date(x)
	      return d.getTime()
      }
      let onclick = (xs) => xs.forEach(x => console.log(x))
      let hm = newHeatmap(document.getElementById("cpu-use"), {
          width: 100,
          height: 10,
          scaleY: .05,
          scaleX: 5000,
          onclick: onclick,
      })

      let hm2 = newHeatmap(document.getElementById("cpu-use2"), {
          width: 100,
          height: 10,
          scaleY: .05,
          scaleX: 5000,
          onclick: onclick,
          colorspace: "LCH",
      })

      let thm = newHeatmap(document.getElementById("throttled-time"), {
          width: 100,
          height: 10,
          scaleY: .05,
          scaleX: 5000,
          onclick: onclick,
      })

      let rs = newHeatmap(document.getElementById("resident"), {
          width: 100,
          height: 20,
          scaleY: 25,
          scaleX: 5000,
          onclick: onclick,
      })

      let ws = new WebSocket(`ws://s.gdf3.com:8080/ws`)
      ws.onmessage = e => {
        let xs = JSON.parse(e.data)

        xs.forEach(x => pods[x.Name] = x)
        let d1 = xs.map(x => ([getTime(x.Time), x.Cpuacct_usage_d/x.Dt, x.Name]))
        let d2 = xs.map(x => ([getTime(x.Time), x.Throttled_time_d/x.Dt, x.Name]))
        let d3 = xs.map(x => ([getTime(x.Time), (x.Total_rss + (x.Total_mapped_file||0))/1000000, x.Name]))

        
        let d4 = d1.map(([a,b,c]) => ([a,b*4,c+"fake1"]))
        let d5 = d1.map(([a,b,c]) => ([a,b*4,c+"fake1"]))
        let d6 = d1.map(([a,b,c]) => ([a,b*7,c+"fake2"]))
        let d7 = d1.map(([a,b,c]) => ([a,b*7,c+"fake2"]))
        let d8 = d1.map(([a,b,c]) => ([a,b*7,c+"fake2"]))
      


        hm.push_back(d4)
        hm.push_back(d5)
        hm.push_back(d6)
        hm.push_back(d7)
        hm.push_back(d8)

        hm.push_back(d1)

        hm2.push_back(d4)
        hm2.push_back(d5)
        hm2.push_back(d6)
        hm2.push_back(d7)
        hm2.push_back(d8)

        hm2.push_back(d1)

        thm.push_back(d2)
        rs.push_back(d3)
      }

  </script>
</body>
</html>
